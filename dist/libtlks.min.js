var packagejson=require("./package.json");exports.version=packagejson.version,exports.talk=require("./lib/talk.js");var MongoClient=require("mongodb").MongoClient;exports.search=function(n,t,o){"use strict";var e=require("search-index")({indexPath:n});e.search(t,function(n,t){if(n)throw new Error(n);return o(null,t)})},exports.all=function(n,t){"use strict";MongoClient.connect(n,function(n,o){if(n)return t(n,null);var e=o.collection("talks");e.find({}).toArray(function(n,e){return n?t(n,null):(o.close(),t(null,e))})})},exports.latest=function(n,t,o){"use strict";MongoClient.connect(n,function(n,e){if(n)return o(n,null);var l=e.collection("talks");l.find({}).sort({created:-1}).limit(t).toArray(function(n,t){return n?o(n,null):(e.close(),o(null,t))})})},exports.popular=function(n,t,o){"use strict";MongoClient.connect(n,function(n,e){if(n)return o(n,null);var l=e.collection("talks");l.find({}).sort({viewCount:-1}).limit(t).toArray(function(n,t){return n?o(n,null):(e.close(),o(null,t))})})},exports.createTalk=function(n,t,o){"use strict";MongoClient.connect(n,function(n,e){if(n)return o(n,null);var l=e.collection("talks");l.insert(t,function(n,t){return n?o(n,null):(e.close(),o(null,t))})})},exports.deleteTalk=function(n,t,o){"use strict";MongoClient.connect(n,function(n,e){if(n)return o(n,null);var l=e.collection("talks");l.remove({id:t},function(n,t){return n?o(n,null):(e.close(),o(null,t))})})},exports.get=function(n,t,o){"use strict";MongoClient.connect(n,function(n,e){if(n)return o(n,null);var l=e.collection("talks");l.findOne({id:t},function(n,t){return n?o(n,null):(e.close(),o(null,t))})})},exports.play=function(n,t,o){"use strict";MongoClient.connect(n,function(n,e){if(n)return o(n,null);var l=e.collection("talks");l.findOne({id:t},function(n,r){return n?o(n,null):(r.ViewCount=r.viewCount+1,void l.update({id:t},{$set:{viewCount:r.viewCount,updated:Date.now()}},function(n){return n?o(n,null):(e.close(),o(null,r))}))})})},exports.getByTag=function(n,t,o){"use strict";return MongoClient.connect(n,function(n,e){if(n)return o(n,null);var l=e.collection("talks");l.find({tags:t}).sort({viewCount:-1}).toArray(function(n,t){return n?o(n,null):(e.close(),o(null,t))})}),!0},exports.getBySlug=function(n,t,o){"use strict";MongoClient.connect(n,function(n,e){if(n)return o(n,null);var l=e.collection("talks");l.find({slug:t}).toArray(function(n,t){return n?o(n,null):(e.close(),o(null,t))})})},exports.related=function(n,t,o){"use strict";MongoClient.connect(n,function(n,e){if(n)return o(n,null);var l=e.collection("talks");l.find({tags:{$in:t.tags}}).toArray(function(n,t){return n?o(n,null):(e.close(),o(null,t))})})},exports.getByAuthorId=function(n,t,o){"use strict";MongoClient.connect(n,function(n,e){if(n)return o(n,null);var l=e.collection("talks");l.find({"author.id":t}).toArray(function(n,t){return n?o(n,null):(e.close(),o(null,t))})})};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYnRsa3MubWluLmpzIl0sIm5hbWVzIjpbInBhY2thZ2Vqc29uIiwicmVxdWlyZSIsImV4cG9ydHMiLCJ2ZXJzaW9uIiwidGFsayIsIk1vbmdvQ2xpZW50Iiwic2VhcmNoIiwiaW5kZXgiLCJxIiwiY2FsbGJhY2siLCJzaSIsImluZGV4UGF0aCIsImVyciIsInJlc3VsdHMiLCJFcnJvciIsImFsbCIsImRidXJsIiwiY29ubmVjdCIsImRiIiwidGFsa3MiLCJjb2xsZWN0aW9uIiwiZmluZCIsInRvQXJyYXkiLCJkb2NzIiwiY2xvc2UiLCJsYXRlc3QiLCJxdWFudGl0eSIsInNvcnQiLCJjcmVhdGVkIiwibGltaXQiLCJwb3B1bGFyIiwidmlld0NvdW50IiwiY3JlYXRlVGFsayIsIm9iaiIsImluc2VydCIsImRlbGV0ZVRhbGsiLCJpZCIsInJlbW92ZSIsImdldCIsImZpbmRPbmUiLCJkb2MiLCJwbGF5IiwiVmlld0NvdW50IiwidXBkYXRlIiwiJHNldCIsInVwZGF0ZWQiLCJEYXRlIiwibm93IiwiZ2V0QnlUYWciLCJ0YWciLCJ0YWdzIiwiZ2V0QnlTbHVnIiwic2x1ZyIsInJlbGF0ZWQiLCIkaW4iLCJnZXRCeUF1dGhvcklkIiwiYXV0aG9yLmlkIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFJQSxhQUFjQyxRQUFRLGlCQUUxQkMsU0FBUUMsUUFBVUgsWUFBWUcsUUFFOUJELFFBQVFFLEtBQU9ILFFBQVEsZ0JBRXZCLElBQUlJLGFBQWNKLFFBQVEsV0FBV0ksV0FPckNILFNBQVFJLE9BQVMsU0FBU0MsRUFBT0MsRUFBR0MsR0FDaEMsWUFDQSxJQUFJQyxHQUFLVCxRQUFRLGlCQUNiVSxVQUFXSixHQUVmRyxHQUFHSixPQUFPRSxFQUFHLFNBQVNJLEVBQUtDLEdBQ3ZCLEdBQUlELEVBQ0EsS0FBTSxJQUFJRSxPQUFNRixFQUVwQixPQUFPSCxHQUFTLEtBQU1JLE1BUzlCWCxRQUFRYSxJQUFNLFNBQVNDLEVBQU9QLEdBQzFCLFlBQ0FKLGFBQVlZLFFBQVFELEVBQU8sU0FBU0osRUFBS00sR0FDckMsR0FBSU4sRUFDQSxNQUFPSCxHQUFTRyxFQUFLLEtBRXpCLElBQUlPLEdBQVFELEVBQUdFLFdBQVcsUUFDMUJELEdBQ0FFLFNBQ0FDLFFBQVEsU0FBU1YsRUFBS1csR0FDbEIsTUFBSVgsR0FDT0gsRUFBU0csRUFBSyxPQUV6Qk0sRUFBR00sUUFDSWYsRUFBUyxLQUFNYyxTQVdsQ3JCLFFBQVF1QixPQUFTLFNBQVNULEVBQU9VLEVBQVVqQixHQUN2QyxZQUNBSixhQUFZWSxRQUFRRCxFQUFPLFNBQVNKLEVBQUtNLEdBQ3JDLEdBQUlOLEVBQ0EsTUFBT0gsR0FBU0csRUFBSyxLQUV6QixJQUFJTyxHQUFRRCxFQUFHRSxXQUFXLFFBQzFCRCxHQUNBRSxTQUNBTSxNQUNJQyxRQUFTLEtBRWJDLE1BQU1ILEdBQ05KLFFBQVEsU0FBU1YsRUFBS1csR0FDbEIsTUFBSVgsR0FDT0gsRUFBU0csRUFBSyxPQUV6Qk0sRUFBR00sUUFDSWYsRUFBUyxLQUFNYyxTQVdsQ3JCLFFBQVE0QixRQUFVLFNBQVNkLEVBQU9VLEVBQVVqQixHQUN4QyxZQUNBSixhQUFZWSxRQUFRRCxFQUFPLFNBQVNKLEVBQUtNLEdBQ3JDLEdBQUlOLEVBQ0EsTUFBT0gsR0FBU0csRUFBSyxLQUV6QixJQUFJTyxHQUFRRCxFQUFHRSxXQUFXLFFBQzFCRCxHQUNBRSxTQUNBTSxNQUNJSSxVQUFXLEtBRWZGLE1BQU1ILEdBQ05KLFFBQVEsU0FBU1YsRUFBS1csR0FDbEIsTUFBSVgsR0FDT0gsRUFBU0csRUFBSyxPQUV6Qk0sRUFBR00sUUFDSWYsRUFBUyxLQUFNYyxTQVdsQ3JCLFFBQVE4QixXQUFhLFNBQVNoQixFQUFPaUIsRUFBS3hCLEdBQ3RDLFlBQ0FKLGFBQVlZLFFBQVFELEVBQU8sU0FBU0osRUFBS00sR0FDckMsR0FBSU4sRUFDQSxNQUFPSCxHQUFTRyxFQUFLLEtBRXpCLElBQUlPLEdBQVFELEVBQUdFLFdBQVcsUUFDMUJELEdBQU1lLE9BQU9ELEVBQUssU0FBU3JCLEVBQUtXLEdBQzVCLE1BQUlYLEdBQ09ILEVBQVNHLEVBQUssT0FFekJNLEVBQUdNLFFBQ0lmLEVBQVMsS0FBTWMsU0FXbENyQixRQUFRaUMsV0FBYSxTQUFTbkIsRUFBT29CLEVBQUkzQixHQUNyQyxZQUNBSixhQUFZWSxRQUFRRCxFQUFPLFNBQVNKLEVBQUtNLEdBQ3JDLEdBQUlOLEVBQ0EsTUFBT0gsR0FBU0csRUFBSyxLQUV6QixJQUFJTyxHQUFRRCxFQUFHRSxXQUFXLFFBQzFCRCxHQUFNa0IsUUFDRkQsR0FBSUEsR0FDTCxTQUFTeEIsRUFBS1csR0FDYixNQUFJWCxHQUNPSCxFQUFTRyxFQUFLLE9BRXpCTSxFQUFHTSxRQUNJZixFQUFTLEtBQU1jLFNBV2xDckIsUUFBUW9DLElBQU0sU0FBU3RCLEVBQU9vQixFQUFJM0IsR0FDOUIsWUFDQUosYUFBWVksUUFBUUQsRUFBTyxTQUFTSixFQUFLTSxHQUNyQyxHQUFJTixFQUNBLE1BQU9ILEdBQVNHLEVBQUssS0FFekIsSUFBSU8sR0FBUUQsRUFBR0UsV0FBVyxRQUMxQkQsR0FBTW9CLFNBQ0ZILEdBQUlBLEdBQ0wsU0FBU3hCLEVBQUs0QixHQUNiLE1BQUk1QixHQUNPSCxFQUFTRyxFQUFLLE9BRXpCTSxFQUFHTSxRQUNJZixFQUFTLEtBQU0rQixTQVlsQ3RDLFFBQVF1QyxLQUFPLFNBQVN6QixFQUFPb0IsRUFBSTNCLEdBQy9CLFlBQ0FKLGFBQVlZLFFBQVFELEVBQU8sU0FBU0osRUFBS00sR0FDckMsR0FBSU4sRUFDQSxNQUFPSCxHQUFTRyxFQUFLLEtBRXpCLElBQUlPLEdBQVFELEVBQUdFLFdBQVcsUUFDMUJELEdBQU1vQixTQUNGSCxHQUFNQSxHQUNQLFNBQVN4QixFQUFLUixHQUNiLE1BQUlRLEdBQ09ILEVBQVNHLEVBQUssT0FFekJSLEVBQUtzQyxVQUFZdEMsRUFBSzJCLFVBQVksTUFDbENaLEdBQU13QixRQUNGUCxHQUFNQSxJQUVOUSxNQUNJYixVQUFXM0IsRUFBSzJCLFVBQ2hCYyxRQUFTQyxLQUFLQyxRQUVuQixTQUFTbkMsR0FDUixNQUFJQSxHQUNPSCxFQUFTRyxFQUFLLE9BRXpCTSxFQUFHTSxRQUNJZixFQUFTLEtBQU1MLFlBWXRDRixRQUFROEMsU0FBVyxTQUFTaEMsRUFBT2lDLEVBQUt4QyxHQUNwQyxZQWtCQSxPQWpCQUosYUFBWVksUUFBUUQsRUFBTyxTQUFTSixFQUFLTSxHQUNyQyxHQUFJTixFQUNBLE1BQU9ILEdBQVNHLEVBQUssS0FFekIsSUFBSU8sR0FBUUQsRUFBR0UsV0FBVyxRQUMxQkQsR0FBTUUsTUFDRjZCLEtBQU1ELElBQ1B0QixNQUNDSSxVQUFXLEtBQ1pULFFBQVEsU0FBU1YsRUFBS1csR0FDckIsTUFBSVgsR0FDT0gsRUFBU0csRUFBSyxPQUV6Qk0sRUFBR00sUUFDSWYsRUFBUyxLQUFNYyxTQUd2QixHQVNYckIsUUFBUWlELFVBQVksU0FBU25DLEVBQU9vQyxFQUFNM0MsR0FDdEMsWUFDQUosYUFBWVksUUFBUUQsRUFBTyxTQUFTSixFQUFLTSxHQUNyQyxHQUFJTixFQUNBLE1BQU9ILEdBQVNHLEVBQUssS0FFekIsSUFBSU8sR0FBUUQsRUFBR0UsV0FBVyxRQUMxQkQsR0FBTUUsTUFDRitCLEtBQVFBLElBQ1Q5QixRQUFRLFNBQVNWLEVBQUtXLEdBQ3JCLE1BQUlYLEdBQ09ILEVBQVNHLEVBQUssT0FFekJNLEVBQUdNLFFBQ0lmLEVBQVMsS0FBTWMsU0FXbENyQixRQUFRbUQsUUFBVSxTQUFTckMsRUFBT1osRUFBTUssR0FDcEMsWUFDQUosYUFBWVksUUFBUUQsRUFBTyxTQUFTSixFQUFLTSxHQUNyQyxHQUFJTixFQUNBLE1BQU9ILEdBQVNHLEVBQUssS0FFekIsSUFBSU8sR0FBUUQsRUFBR0UsV0FBVyxRQUMxQkQsR0FBTUUsTUFDRjZCLE1BQ0lJLElBQUtsRCxFQUFLOEMsUUFFZjVCLFFBQVEsU0FBU1YsRUFBS1csR0FDckIsTUFBSVgsR0FDT0gsRUFBU0csRUFBSyxPQUV6Qk0sRUFBR00sUUFDSWYsRUFBUyxLQUFNYyxTQVdsQ3JCLFFBQVFxRCxjQUFnQixTQUFTdkMsRUFBT29CLEVBQUkzQixHQUN4QyxZQUNBSixhQUFZWSxRQUFRRCxFQUFPLFNBQVNKLEVBQUtNLEdBQ3JDLEdBQUlOLEVBQ0EsTUFBT0gsR0FBU0csRUFBSyxLQUV6QixJQUFJTyxHQUFRRCxFQUFHRSxXQUFXLFFBQzFCRCxHQUFNRSxNQUNGbUMsWUFBYXBCLElBQ2RkLFFBQVEsU0FBU1YsRUFBS1csR0FDckIsTUFBSVgsR0FDT0gsRUFBU0csRUFBSyxPQUV6Qk0sRUFBR00sUUFDSWYsRUFBUyxLQUFNYyIsImZpbGUiOiJsaWJ0bGtzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBwYWNrYWdlanNvbj1yZXF1aXJlKFwiLi9wYWNrYWdlLmpzb25cIik7ZXhwb3J0cy52ZXJzaW9uPXBhY2thZ2Vqc29uLnZlcnNpb24sZXhwb3J0cy50YWxrPXJlcXVpcmUoXCIuL2xpYi90YWxrLmpzXCIpO3ZhciBNb25nb0NsaWVudD1yZXF1aXJlKFwibW9uZ29kYlwiKS5Nb25nb0NsaWVudDtleHBvcnRzLnNlYXJjaD1mdW5jdGlvbihuLHQsbyl7XCJ1c2Ugc3RyaWN0XCI7dmFyIGU9cmVxdWlyZShcInNlYXJjaC1pbmRleFwiKSh7aW5kZXhQYXRoOm59KTtlLnNlYXJjaCh0LGZ1bmN0aW9uKG4sdCl7aWYobil0aHJvdyBuZXcgRXJyb3Iobik7cmV0dXJuIG8obnVsbCx0KX0pfSxleHBvcnRzLmFsbD1mdW5jdGlvbihuLHQpe1widXNlIHN0cmljdFwiO01vbmdvQ2xpZW50LmNvbm5lY3QobixmdW5jdGlvbihuLG8pe2lmKG4pcmV0dXJuIHQobixudWxsKTt2YXIgZT1vLmNvbGxlY3Rpb24oXCJ0YWxrc1wiKTtlLmZpbmQoe30pLnRvQXJyYXkoZnVuY3Rpb24obixlKXtyZXR1cm4gbj90KG4sbnVsbCk6KG8uY2xvc2UoKSx0KG51bGwsZSkpfSl9KX0sZXhwb3J0cy5sYXRlc3Q9ZnVuY3Rpb24obix0LG8pe1widXNlIHN0cmljdFwiO01vbmdvQ2xpZW50LmNvbm5lY3QobixmdW5jdGlvbihuLGUpe2lmKG4pcmV0dXJuIG8obixudWxsKTt2YXIgbD1lLmNvbGxlY3Rpb24oXCJ0YWxrc1wiKTtsLmZpbmQoe30pLnNvcnQoe2NyZWF0ZWQ6LTF9KS5saW1pdCh0KS50b0FycmF5KGZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4/byhuLG51bGwpOihlLmNsb3NlKCksbyhudWxsLHQpKX0pfSl9LGV4cG9ydHMucG9wdWxhcj1mdW5jdGlvbihuLHQsbyl7XCJ1c2Ugc3RyaWN0XCI7TW9uZ29DbGllbnQuY29ubmVjdChuLGZ1bmN0aW9uKG4sZSl7aWYobilyZXR1cm4gbyhuLG51bGwpO3ZhciBsPWUuY29sbGVjdGlvbihcInRhbGtzXCIpO2wuZmluZCh7fSkuc29ydCh7dmlld0NvdW50Oi0xfSkubGltaXQodCkudG9BcnJheShmdW5jdGlvbihuLHQpe3JldHVybiBuP28obixudWxsKTooZS5jbG9zZSgpLG8obnVsbCx0KSl9KX0pfSxleHBvcnRzLmNyZWF0ZVRhbGs9ZnVuY3Rpb24obix0LG8pe1widXNlIHN0cmljdFwiO01vbmdvQ2xpZW50LmNvbm5lY3QobixmdW5jdGlvbihuLGUpe2lmKG4pcmV0dXJuIG8obixudWxsKTt2YXIgbD1lLmNvbGxlY3Rpb24oXCJ0YWxrc1wiKTtsLmluc2VydCh0LGZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4/byhuLG51bGwpOihlLmNsb3NlKCksbyhudWxsLHQpKX0pfSl9LGV4cG9ydHMuZGVsZXRlVGFsaz1mdW5jdGlvbihuLHQsbyl7XCJ1c2Ugc3RyaWN0XCI7TW9uZ29DbGllbnQuY29ubmVjdChuLGZ1bmN0aW9uKG4sZSl7aWYobilyZXR1cm4gbyhuLG51bGwpO3ZhciBsPWUuY29sbGVjdGlvbihcInRhbGtzXCIpO2wucmVtb3ZlKHtpZDp0fSxmdW5jdGlvbihuLHQpe3JldHVybiBuP28obixudWxsKTooZS5jbG9zZSgpLG8obnVsbCx0KSl9KX0pfSxleHBvcnRzLmdldD1mdW5jdGlvbihuLHQsbyl7XCJ1c2Ugc3RyaWN0XCI7TW9uZ29DbGllbnQuY29ubmVjdChuLGZ1bmN0aW9uKG4sZSl7aWYobilyZXR1cm4gbyhuLG51bGwpO3ZhciBsPWUuY29sbGVjdGlvbihcInRhbGtzXCIpO2wuZmluZE9uZSh7aWQ6dH0sZnVuY3Rpb24obix0KXtyZXR1cm4gbj9vKG4sbnVsbCk6KGUuY2xvc2UoKSxvKG51bGwsdCkpfSl9KX0sZXhwb3J0cy5wbGF5PWZ1bmN0aW9uKG4sdCxvKXtcInVzZSBzdHJpY3RcIjtNb25nb0NsaWVudC5jb25uZWN0KG4sZnVuY3Rpb24obixlKXtpZihuKXJldHVybiBvKG4sbnVsbCk7dmFyIGw9ZS5jb2xsZWN0aW9uKFwidGFsa3NcIik7bC5maW5kT25lKHtpZDp0fSxmdW5jdGlvbihuLHIpe3JldHVybiBuP28obixudWxsKTooci5WaWV3Q291bnQ9ci52aWV3Q291bnQrMSx2b2lkIGwudXBkYXRlKHtpZDp0fSx7JHNldDp7dmlld0NvdW50OnIudmlld0NvdW50LHVwZGF0ZWQ6RGF0ZS5ub3coKX19LGZ1bmN0aW9uKG4pe3JldHVybiBuP28obixudWxsKTooZS5jbG9zZSgpLG8obnVsbCxyKSl9KSl9KX0pfSxleHBvcnRzLmdldEJ5VGFnPWZ1bmN0aW9uKG4sdCxvKXtcInVzZSBzdHJpY3RcIjtyZXR1cm4gTW9uZ29DbGllbnQuY29ubmVjdChuLGZ1bmN0aW9uKG4sZSl7aWYobilyZXR1cm4gbyhuLG51bGwpO3ZhciBsPWUuY29sbGVjdGlvbihcInRhbGtzXCIpO2wuZmluZCh7dGFnczp0fSkuc29ydCh7dmlld0NvdW50Oi0xfSkudG9BcnJheShmdW5jdGlvbihuLHQpe3JldHVybiBuP28obixudWxsKTooZS5jbG9zZSgpLG8obnVsbCx0KSl9KX0pLCEwfSxleHBvcnRzLmdldEJ5U2x1Zz1mdW5jdGlvbihuLHQsbyl7XCJ1c2Ugc3RyaWN0XCI7TW9uZ29DbGllbnQuY29ubmVjdChuLGZ1bmN0aW9uKG4sZSl7aWYobilyZXR1cm4gbyhuLG51bGwpO3ZhciBsPWUuY29sbGVjdGlvbihcInRhbGtzXCIpO2wuZmluZCh7c2x1Zzp0fSkudG9BcnJheShmdW5jdGlvbihuLHQpe3JldHVybiBuP28obixudWxsKTooZS5jbG9zZSgpLG8obnVsbCx0KSl9KX0pfSxleHBvcnRzLnJlbGF0ZWQ9ZnVuY3Rpb24obix0LG8pe1widXNlIHN0cmljdFwiO01vbmdvQ2xpZW50LmNvbm5lY3QobixmdW5jdGlvbihuLGUpe2lmKG4pcmV0dXJuIG8obixudWxsKTt2YXIgbD1lLmNvbGxlY3Rpb24oXCJ0YWxrc1wiKTtsLmZpbmQoe3RhZ3M6eyRpbjp0LnRhZ3N9fSkudG9BcnJheShmdW5jdGlvbihuLHQpe3JldHVybiBuP28obixudWxsKTooZS5jbG9zZSgpLG8obnVsbCx0KSl9KX0pfSxleHBvcnRzLmdldEJ5QXV0aG9ySWQ9ZnVuY3Rpb24obix0LG8pe1widXNlIHN0cmljdFwiO01vbmdvQ2xpZW50LmNvbm5lY3QobixmdW5jdGlvbihuLGUpe2lmKG4pcmV0dXJuIG8obixudWxsKTt2YXIgbD1lLmNvbGxlY3Rpb24oXCJ0YWxrc1wiKTtsLmZpbmQoe1wiYXV0aG9yLmlkXCI6dH0pLnRvQXJyYXkoZnVuY3Rpb24obix0KXtyZXR1cm4gbj9vKG4sbnVsbCk6KGUuY2xvc2UoKSxvKG51bGwsdCkpfSl9KX07Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9